---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/sections/Footer.astro';
import Header from '../components/sections/Header.astro';
import PostNav from '../components/ui/nav/PostNav.astro';
import { YouTube } from "astro-embed";

type BlogData = CollectionEntry<'blog'>['data'];
type Props = BlogData & {
  showHeader?: boolean;
  prevPost?: { id: string; title: string } | null;
  nextPost?: { id: string; title: string } | null;
};

const {
  title,
  description,
  heroImage,
  tags = [],
  youtubeID,
  youtubeTitle,
  showHeader = true,
  prevPost = null,
  nextPost = null,
} = Astro.props as Props;
---

<html lang="en" data-theme="dark" class="dark">
  <head>
    <BaseHead title={title} description={description} image={heroImage} />
    <meta property="og:type" content="article" />
    <meta property="article:author" content="Nahuel Aparicio" />

    {tags.map((t) => (
      <meta property="article:tag" content={t} />
    ))}
    
    <style>
      main {
        width: 1280px;
        max-width: calc(100% - 2em);
        margin: auto;
        background: var(--color-bg-primary);
      }
      .hero-image {
        width: 100%;
      }
      .hero-image img {
        display: block;
        margin: 0 auto;
        border-radius: 12px;
        box-shadow: var(--box-shadow);
      }
      .prose {
        width: 100%;
        max-width: 870px;
        margin: auto;
        padding: 0.05em;
        color: var(--color-text-secondary);
      }
      .title {
        margin-bottom: 1em;
        padding: 1em 0;
        text-align: center;
        line-height: 1;
      }
      .title h1 {
        margin: 0 0 0.5em 0;
        color: var(--color-text-primary);
      }
      .yt-video {
        width: 100%;
      }
      .yt-frame {
        max-width: 663px;
        margin: 0 auto;
        position: relative;
        aspect-ratio: 16 / 9;
        border-radius: 12px;
        box-shadow: var(--box-shadow);
        overflow: hidden;
      }
      .yt-frame iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: 0;
      }
    </style>
  </head>

  <body>
    <Header />
    <main>
      <article>
        {showHeader && (
          <>
            {youtubeID ? (
              <div class="yt-video">
                <div class="yt-frame">
                  <YouTube id={youtubeID} title={youtubeTitle} />
                </div>
              </div>
            ) : (
              <div class="hero-image">
                {heroImage && (
                  <Image
                    width={1020 * 0.65}
                    height={510 * 0.65}
                    src={heroImage}
                    alt={title}
                  />
                )}
              </div>
            )}
          </>
        )}

        <div class="prose">
          {showHeader && (
            <div class="title">
              <h1><b>{title}</b></h1>
              <hr />
            </div>
          )}

          <slot />
          <PostNav prev={prevPost} next={nextPost} />
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
